<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/ully.js - Ully API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Ully API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.5.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Helpers.html">Helpers</a></li>
            
                <li><a href="../classes/Ully.html">Ully</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib/ully.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
 * ully
 * https://github.com/ullyin/ully
 *
 * Copyright (c) 2014, EnyTC Corporation
 * Licensed under the BSD license.
 */

&#x27;use strict&#x27;;

/*
 * Module Dependencies
 */

var request = require(&#x27;superagent&#x27;),
    inquirer = require(&#x27;inquirer&#x27;),
    async = require(&#x27;async&#x27;),
    _ = require(&#x27;underscore&#x27;),
    h = require(&#x27;./helpers.js&#x27;),
    join = require(&#x27;path&#x27;).join;

/*
 * Public Methods
 */

/**
 * @class Ully
 *
 * @constructor
 *
 * Constructor responsible for provide api requests
 *
 * @example
 *
 *     var api = new Ully(&#x27;AccessToken&#x27;);
 *
 * @param {String} AccessToken Access Token
 */

var Ully = module.exports = function Ully(accessToken) {
    //Access Token
    this.AccessToken = accessToken;
    //apiUri
    this.uri = process.env.ULLY_URI || &#x27;https://ully.in/api/&#x27;;
    var apiUri = this.uri + &#x27;:path&#x27;;
    //Get handler
    this.get = function(path, callback) {
        request
            .get(apiUri.replace(new RegExp(&#x27;:path&#x27;, &#x27;g&#x27;), path).replace(new RegExp(&#x27;:token&#x27;, &#x27;g&#x27;), &#x27;access_token=&#x27; + this.AccessToken))
            .set(&#x27;Accept&#x27;, &#x27;application/json&#x27;)
            .end(callback);
    };
    //Post handler
    this.post = function(path, body, callback) {
        request
            .post(apiUri.replace(new RegExp(&#x27;:path&#x27;, &#x27;g&#x27;), path).replace(new RegExp(&#x27;:token&#x27;, &#x27;g&#x27;), &#x27;access_token=&#x27; + this.AccessToken))
            .send(body)
            .set(&#x27;Accept&#x27;, &#x27;application/json&#x27;)
            .end(callback);
    };
    //Put handler
    this.put = function(path, body, callback) {
        request
            .put(apiUri.replace(new RegExp(&#x27;:path&#x27;, &#x27;g&#x27;), path).replace(new RegExp(&#x27;:token&#x27;, &#x27;g&#x27;), &#x27;access_token=&#x27; + this.AccessToken))
            .send(body)
            .set(&#x27;Accept&#x27;, &#x27;application/json&#x27;)
            .end(callback);
    };
    //Delete handler
    this.delete = function(path, body, callback) {
        request
            .del(apiUri.replace(new RegExp(&#x27;:path&#x27;, &#x27;g&#x27;), path).replace(new RegExp(&#x27;:token&#x27;, &#x27;g&#x27;), &#x27;access_token=&#x27; + this.AccessToken))
            .send(body)
            .set(&#x27;Accept&#x27;, &#x27;application/json&#x27;)
            .end(callback);
    };
};

//HandlerExceptions
process.on(&#x27;uncaughtException&#x27;, function(err) {
    console.log();
    console.error(err);
    console.log();
    console.error(err.stack);
});

/**
 * Method responsible for asking questions
 *
 * @example
 *
 *     api.prompt(prompts, callback);
 *
 * @method prompt
 * @public
 * @param {Object} prompts Array of prompt options
 * @param {Function} callback A callback
 */

Ully.prototype.prompt = function prompt(prompts, callback) {
    inquirer.prompt(prompts, function(answers) {
        callback(answers);
    });
};

/**
 * Method responsible for login in accounts
 *
 * @example
 *
 *     api.login(&#x27;accessToken&#x27;, function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method login
 * @public
 * @param {String} AccessToken A Access Token
 * @param {Function} callback A callback with api response
 */

Ully.prototype.login = function login(accessToken, callback) {
    //Write config
    if (accessToken &amp;&amp; accessToken &gt; 0) {
        h.write(join(__dirname, &#x27;ullyConfig.json&#x27;), JSON.stringify({accessToken: accessToken}, null, 4));
        return callback(null, {
            message: &#x27;Logged successfully!&#x27;
        });
    } else {
        return callback(null, {
            message: &#x27;Login failed. Try again!&#x27;
        });
    }
};

/**
 * Method responsible for showing stats of Ully
 *
 * @example
 *
 *     api.stats(function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method stats
 * @public
 * @param {Function} callback A callback with api response
 */

Ully.prototype.stats = function stats(callback) {
    this.get(&#x27;stats&#x27;, function(err, res) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, res.body.response);
            }
        }
    });
};

/**
 * Method responsible for showing stats of a specific user
 *
 * @example
 *
 *     api.statsByUsername(&#x27;myusername&#x27;, function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method statsByUsername
 * @public
 * @param {String} username Username
 * @param {Function} callback A callback with api response
 */

Ully.prototype.statsByUsername = function statsByUsername(username, callback) {
    this.get(join(&#x27;stats&#x27;, username, &#x27;?:token&#x27;), function(err, res) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, res.body.response);
            }
        }
    });
};

/**
 * Method responsible for showing the status of api
 *
 * @example
 *
 *     api.status(function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method status
 * @public
 * @param {Function} callback A callback with api response
 */

Ully.prototype.status = function status(callback) {
    this.get(&#x27;status&#x27;, function(err, res) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, res.body.response);
            }
        }
    });
};


/**
 * Method responsible for showing profile info
 *
 * @example
 *
 *     api.account(function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method account
 * @public
 * @param {Function} callback A callback with api response
 */

Ully.prototype.account = function account(callback) {
    this.get(&#x27;account?:token&#x27;, function(err, res) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, res.body.response);
            }
        }
    });
};

/**
 * Method responsible for update profile info
 *
 * @example
 *
 *     api.updateAccount(&#x27;name&#x27;, email&#x27;, &#x27;username&#x27;, &#x27;currentPassword&#x27;, &#x27;password&#x27;, function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method updateAccount
 * @public
 * @param {String} name Name
 * @param {String} email Email
 * @param {String} username Username
 * @param {String} currentPassword Current Password
 * @param {String} password Password
 * @param {Function} callback A callback with api response
 */

Ully.prototype.updateAccount = function updateAccount(name, email, username, currentPassword, password, callback) {
    this.put(&#x27;account?:token&#x27;, {
        name: name,
        email: email,
        username: username,
        currentpassword: currentPassword,
        password: password
    }, function(err, res) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, res.body.response);
            }
        }
    });
};

/**
 * Method responsible for list all collections
 *
 * @example
 *
 *     api.collections(function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method collections
 * @public
 * @param {Function} callback A callback with api response
 */

Ully.prototype.collections = function collections(callback) {
    this.get(&#x27;collections?fields=name,slug,urls,public&amp;:token&#x27;, function(err, res) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, res.body.response);
            }
        }
    });
};


/**
 * Method responsible for list all collections of a specific user
 *
 * @example
 *
 *     api.collectionsByUsername(&#x27;myusername&#x27;, function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method collectionsByUsername
 * @public
 * @param {String} username Username
 * @param {Function} callback A callback with api response
 */

Ully.prototype.collectionsByUsername = function collectionsByUsername(username, callback) {
    this.get(join(&#x27;collections&#x27;, &#x27;of&#x27;, username, &#x27;?fields=name,slug,urls,public&amp;:token&#x27;), function(err, res) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, res.body.response);
            }
        }
    });
};

/**
 * Method responsible for generate a dinamic list of collections
 *
 * @example
 *
 *     api.listCollections();
 *
 * @method listCollections
 * @public
 * @param {Function} callback A callback
 */

Ully.prototype.listCollections = function listCollections(callback) {
    this.get(&#x27;collections?:token&#x27;, function(err, res) {
        if (err) {
            throw err;
        }
        var list = [];
        //Start
        _.each(res.body.response, function(val) {
            list.push({
                name: val.name + &#x27; -&gt; &#x27; + val.slug,
                value: val.slug
            });
        });
        //Callback
        callback(list);
    });
};

/**
 * Method responsible for generate a dinamic list of urls
 *
 * @example
 *
 *     api.listUrls();
 *
 * @method listUrls
 * @public
 * @param {String} collection Username
 * @param {Function} callback A callback
 */

Ully.prototype.listUrls = function listUrls(collection, callback) {
    this.get(&#x27;collections?:token&#x27;, function(err, res) {
        if (err) {
            throw err;
        }
        var list = [];
        var selectedCollection = _.where(res.body.response, {
            slug: collection
        });
        //Start
        _.each(selectedCollection[0].urls, function(val) {
            list.push({
                name: val.url,
                value: val._id
            });
        });
        //Callback
        callback(list);
    });
};

/**
 * Method responsible for create a new collection
 *
 * @example
 *
 *     api.createCollections(&#x27;name&#x27;, &#x27;slug&#x27;, &#x27;public&#x27;, function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method createCollections
 * @public
 * @param {String} name Name
 * @param {String} slug Slug
 * @param {Boolean} publicCollection Public Collection
 * @param {Function} callback A callback with api response
 */

Ully.prototype.createCollections = function createCollections(name, slug, publicCollection, callback) {
    this.post(&#x27;collections?:token&#x27;, {
        name: name,
        slug: slug,
        public: publicCollection
    }, function(err, res) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, res.body.response);
            }
        }
    });
};

/**
 * Method responsible for update a specific collection
 *
 * @example
 *
 *     api.updateCollections(&#x27;collectionSlug&#x27;, &#x27;name&#x27;, &#x27;slug&#x27;, &#x27;public&#x27;, function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method updateCollections
 * @public
 * @param {String} collectionSlug Slug
 * @param {String} name Name
 * @param {String} slug Slug
 * @param {Boolean} publicCollection Public Collection
 * @param {Function} callback A callback with api response
 */

Ully.prototype.updateCollections = function updateCollections(collectionSlug, name, slug, publicCollection, callback) {
    this.put(join(&#x27;collections&#x27;, collectionSlug, &#x27;?:token&#x27;), {
        name: name,
        slug: slug,
        public: publicCollection
    }, function(err, res) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, res.body.response);
            }
        }
    });
};

/**
 * Method responsible for delete a specific collection
 *
 * @example
 *
 *     api.deleteCollections(&#x27;collectionSlug&#x27;, function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method deleteCollections
 * @public
 * @param {String} collectionSlug Slug
 * @param {Function} callback A callback with api response
 */

Ully.prototype.deleteCollections = function deleteCollections(collectionSlug, callback) {
    this.delete(join(&#x27;collections&#x27;, collectionSlug, &#x27;?:token&#x27;), null, function(err, res) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, res.body.response);
            }
        }
    });
};

/**
 * Method responsible for create a new url
 *
 * @example
 *
 *     api.createUrls(&#x27;collectionSlug&#x27;, &#x27;url&#x27;, &#x27;title&#x27;, &#x27;description&#x27;, function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method createUrls
 * @public
 * @param {String} collectionSlug Collection Slug
 * @param {String} url Url
 * @param {String} title Title
 * @param {String} description Description of url
 * @param {Function} callback A callback with api response
 */

Ully.prototype.createUrls = function createUrls(collectionSlug, url, title, description, callback) {
    this.post(join(&#x27;collections&#x27;, collectionSlug, &#x27;urls&#x27;, &#x27;?:token&#x27;), {
        title: title,
        url: url,
        description: description
    }, function(err, res) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, res.body.response);
            }
        }
    });
};

/**
 * Method responsible for update a specific url
 *
 * @example
 *
 *     api.updateUrls(&#x27;collectionSlug&#x27;, &#x27;title&#x27;, &#x27;url&#x27;, &#x27;description&#x27;, function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method updateUrls
 * @public
 * @param {String} collectionSlug Collection Slug
 * @param {String} urlID Url ID
 * @param {String} url Url
 * @param {String} title Title
 * @param {String} description Description of url
 * @param {Function} callback A callback with api response
 */

Ully.prototype.updateUrls = function updateUrls(collectionSlug, urlID, url, title, description, callback) {
    this.put(join(&#x27;collections&#x27;, collectionSlug, &#x27;urls&#x27;, urlID, &#x27;?:token&#x27;), {
        title: title,
        url: url,
        description: description
    }, function(err, res) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, res.body.response);
            }
        }
    });
};

/**
 * Method responsible for delete a specific url
 *
 * @example
 *
 *     api.deleteUrls(&#x27;collectionSlug&#x27;, urlsID, function(err, data) {
 *          console.log(data);
 *     });
 *
 * @method deleteUrls
 * @public
 * @param {String} collectionSlug Slug
 * @param {String} urlsID Array of urls id
 * @param {Function} callback A callback with api response
 */

Ully.prototype.deleteUrls = function deleteUrls(collectionSlug, urlsID, callback) {
    var self = this;
    async.eachSeries(urlsID, function(item, cb) {
        self.delete(join(&#x27;collections&#x27;, collectionSlug, &#x27;urls&#x27;, item, &#x27;?:token&#x27;), null, function(err) {
            if (err) {
                cb(err);
            }
            cb(null);
        });
    }, function(err) {
        if (callback) {
            if (err) {
                callback(err);
            } else {
                callback(null, {
                    msg: &#x27;All selected urls are successfully deleted!&#x27;
                });
            }
        }
    });
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
